<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Melo - Music</title>
    <script src="https://kit.fontawesome.com/1e41634bbd.js" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="/css/music_tab.css">
    <link rel="stylesheet" href="/css/sidebar.css">
    <link rel="stylesheet" href="css/music_player.css">
   
</head>
<body>
        <div class="header">
            <div class="menu-icon" id="menuIcon"> ☰ </div>
            <img src="/image/melo_dark.png" alt="logo"> 
            <div class="profile-icon"><i class="fas fa-user-circle"></i></div>
        </div>

        <!-- Sidebar -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h2>Menu</h2>
                <button class="close-btn" id="closeBtn">✕</button>
            </div>
            <ul class="sidebar-menu">
                <li><a href="homepage_all.html"><i class="fas fa-home"></i> Home</a></li>
                <li><a href="music_tab.html"><i class="fas fa-music"></i> Music</a></li>
                <li><a href="podcast_tab.html"><i class="fas fa-podcast"></i> Podcasts</a></li>
                <li><a href="#"><i class="fas fa-heart"></i> Liked Songs</a></li>
                <li><a href="#"><i class="fas fa-cog"></i> Settings</a></li>
            </ul>
            <div class="user-account-section" id="userAccountSection">
                <div class="user-signed-in" id="userSignedIn" style="display: none;">
                    <div class="user-profile-container">
                        <i class="fas fa-user" id="userProfileIcon"></i>
                    </div>
                    <div class="user-info">
                        <p class="user-name" id="userName"></p>
                        <button class="logout-btn" id="logoutBtn">Log out</button>
                    </div>
                </div>
                <div class="user-signed-out" id="userSignedOut">
                    <i class="fas fa-user-circle"></i>
                    <a href="login.html" class="login-btn">Log in</a>
                </div>
            </div>
        </nav>

        <!-- Overlay -->
        <div class="overlay" id="overlay"></div>

        <div class="content">
            <div class="filters">
                <a href="homepage_all.html" class="filter-btn">All</a>
                <button class="filter-btn active">Music</button>
                <a href="podcast_tab.html" class="filter-btn">Podcasts</a>
            </div>

            <section class="section">
                <h2>Your playlists: </h2>
                <div class="music-grid">
                    <div class="music-card">
                        <img src="/image/cat.jpg" alt="happy happy">
                        <p>Playlist 1</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/chiikawa.jpg" alt="mueheh">
                        <p>Playlist 2</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/cirrus.jpg" alt="playlist 3">
                        <p>Playlist 3</p>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>On repeat: </h2>
                <div class="single_poster-card">
                    <img src="/image/wannabewithu- CUCO.jpg" alt="repeat">
                    <div class="single_poster-info">
                        <h3>wannabewithu - Lover is a day</h3>
                        <p>Cuco</p>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>Trending albums</h2>
                <div class="music-grid">
                    <div class="music-card">
                        <img src="/image/Joji Ballads.jpg" alt="joji">
                        <p>Ballads - Joji</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/Submarine - The Marias.jpg" alt="submarine">
                        <p>Submarine - The Marías</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/Son of Spergy - Daniel Caesar [VINYL].jpg" alt="son of spergy">
                        <p>Son of spergy - Daniel Caesar</p>
                    </div>
                </div>
            </section>

            <section class="section">
                <h2>Your favorite artists</h2>
                <div class="music-grid artist-grid">
                    <div class="music-card">
                        <img src="/image/svt.jpg" alt="svt">
                        <h3>Seventeen</h3>
                    </div>
                    <div class="music-card">
                        <img src="/image/txt.jpg" alt="txt">
                        <h3>Tomorrow X Together</h3>
                    </div>
                </div>
            </section>

             <section class="section">
                <h2>Songs you may enjoy</h2>
                <div class="music-grid">
                    <div class="music-card">
                        <img src="/image/laufey.jpg" alt="laufey">
                        <p>Lover Girl - Laufey</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/beatopia.jpg" alt="beabodoobee">
                        <p>Ripples - Beabodoobee</p>
                    </div>
                    <div class="music-card">
                        <img src="/image/THE 1975.jpg" alt="the1975">
                        <p>About you - The 1975</p>
                    </div>
                </div>
            </section>
        </div>        

        <nav class="bottom-nav">
            <a href="#" class="nav-item active">
                <i class="fas fa-home"></i>
                <span>Home</span>
            </a>
            <a href="search.html" class="nav-item" id="searchNavBtn">
                <i class="fas fa-search"></i>
                <span>Search</span>
            </a>
            <a href="library.html" class="nav-item">
                <i class="fa-solid fa-swatchbook"></i>
                <span>Library</span>
            </a>
        </nav>

    <!-- Fixed Music Player Island -->
    <div class="music-player-island" id="musicPlayerIsland" style="display: none;">
        <div class="song-title" id="playerSongTitle">Song Title</div>
        <div class="progress-section">
            <span class="current-time" id="currentTime">0:00</span>
            <div class="progress-bar-container" id="progressBarContainer">
                <div class="progress-bar-fill" id="progressBarFill"></div>
            </div>
            <span class="total-time" id="totalTime">0:00</span>
        </div>
        <div class="player-controls">
            <button class="control-btn play-pause-btn" id="playPauseBtn">
                <i class="fas fa-pause"></i>
            </button>
            <div class="volume-control">
                <i class="fas fa-volume-up" id="volumeIcon"></i>
                <input type="range" class="volume-slider" id="volumeSlider" min="0" max="100" value="70">
            </div>
        </div>
    </div>
        
    <!-- Hidden audio element -->
    <audio id="audioPlayer"></audio>
    
    <script src="/js/filter.js"></script>
    <script src="/js/sidebar.js"></script>
    <script>
        console.log('Audio player script started');
        
        const cardSongs = {
            'Tyler, The creator': 'See You Again.mp3',
            'TV Girl': 'Lovers Rock.mp3',
            'Clairo': 'Flamin Hot Cheetos.mp3',
            'Calling U Back': 'calling you back.mp3',
            'Not Cute Anymore': 'Not cute anymore.mp3',
            'Emails I can\'t send': 'emails i cant send.mp3',
            'Brighter days ahead': 'eternal sunshine.mp3',
            'This is how tomorrow moves': 'Take A Bite.mp3',
            'No doubt - Enhypen': 'No Doubt.mp3',
            'UP NO MORE - Twice': 'UP NO MORE.mp3',
            'Hurt - NewJeans': 'Hurt.mp3',
            'wannabewithu - Lover is a day': 'Lover Is a Day.mp3',
            'Ballads - Joji': 'Slow Dancing In The Dark.mp3',
            'Submarine - The Marías': 'Sienna.mp3',
            'Son of spergy - Daniel Caesar': 'Who Knows.mp3',
            'Lover Girl - Laufey': 'Lover Girl.mp3',
            'Ripples - Beabodoobee': 'Ripples.mp3',
            'About you - The 1975': 'About You.mp3',
        };
        
        let currentCard = null;
        let isPlaying = false;
        const audioPlayer = document.getElementById('audioPlayer');
        const musicPlayerIsland = document.getElementById('musicPlayerIsland');
        const playerSongTitle = document.getElementById('playerSongTitle');
        const currentTime = document.getElementById('currentTime');
        const totalTime = document.getElementById('totalTime');
        const progressBarFill = document.getElementById('progressBarFill');
        const progressBarContainer = document.getElementById('progressBarContainer');
        const playPauseBtn = document.getElementById('playPauseBtn');
        const volumeSlider = document.getElementById('volumeSlider');
        const volumeIcon = document.getElementById('volumeIcon');

        // Set initial volume
        audioPlayer.volume = 0.7;

        // Format time helper
        function formatTime(seconds) {
            if (!seconds || isNaN(seconds)) return '0:00';
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return mins + ':' + (secs < 10 ? '0' : '') + secs;
        }

        // Update play/pause button
        function updatePlayPauseBtn() {
            if (isPlaying) {
                playPauseBtn.innerHTML = '<i class="fas fa-pause"></i>';
            } else {
                playPauseBtn.innerHTML = '<i class="fas fa-play"></i>';
            }
        }

        // Play/pause control
        playPauseBtn.addEventListener('click', function() {
            if (isPlaying) {
                audioPlayer.pause();
                isPlaying = false;
            } else {
                audioPlayer.play();
                isPlaying = true;
            }
            updatePlayPauseBtn();
        });

        // Volume control
        volumeSlider.addEventListener('input', function() {
            audioPlayer.volume = this.value / 100;
            
            // Update volume icon
            if (this.value == 0) {
                volumeIcon.className = 'fas fa-volume-mute';
            } else if (this.value < 50) {
                volumeIcon.className = 'fas fa-volume-down';
            } else {
                volumeIcon.className = 'fas fa-volume-up';
            }
        });

        // Toggle mute on icon click
        volumeIcon.addEventListener('click', function() {
            if (audioPlayer.volume > 0) {
                audioPlayer.volume = 0;
                volumeSlider.value = 0;
                volumeIcon.className = 'fas fa-volume-mute';
            } else {
                audioPlayer.volume = 0.7;
                volumeSlider.value = 70;
                volumeIcon.className = 'fas fa-volume-up';
            }
        });

        // Update player display
        audioPlayer.addEventListener('timeupdate', function() {
            if (audioPlayer.duration) {
                currentTime.textContent = formatTime(audioPlayer.currentTime);
                totalTime.textContent = formatTime(audioPlayer.duration);
                
                const percent = (audioPlayer.currentTime / audioPlayer.duration) * 100;
                progressBarFill.style.width = percent + '%';
            }
        });

        // Handle audio events
        audioPlayer.addEventListener('play', function() {
            isPlaying = true;
            updatePlayPauseBtn();
        });

        audioPlayer.addEventListener('pause', function() {
            isPlaying = false;
            updatePlayPauseBtn();
        });

        audioPlayer.addEventListener('ended', function() {
            isPlaying = false;
            updatePlayPauseBtn();
            progressBarFill.style.width = '0%';
        });
        
        // Seek functionality
        progressBarContainer.addEventListener('click', function(e) {
            if (audioPlayer.duration) {
                const rect = this.getBoundingClientRect();
                const percent = (e.clientX - rect.left) / rect.width;
                audioPlayer.currentTime = percent * audioPlayer.duration;
            }
        });
        
        function setupAudioPlayer() {
            console.log('Setting up audio player');
            // Select both music-card and single_poster-card elements
            const cards = document.querySelectorAll('.music-card, .single_poster-card');
            console.log('Found ' + cards.length + ' music cards');
            
            cards.forEach(card => {
                card.style.cursor = 'pointer';
                card.addEventListener('click', function() {
                    // For single_poster-card, the title is in h3, for music-card it's in p
                    let titleElement;
                    if (this.classList.contains('single_poster-card')) {
                        titleElement = this.querySelector('.single_poster-info h3') || this.querySelector('h3');
                    } else {
                        titleElement = this.querySelector('p');
                    }
                    if (!titleElement) return;
                    
                    const cardText = titleElement.textContent.trim();
                    const songFile = cardSongs[cardText];
                    
                    console.log('Clicked: ' + cardText + ', Song: ' + songFile);
                    
                    if (songFile) {
                        if (currentCard) {
                            currentCard.classList.remove('now-playing');
                        }
                        
                        this.classList.add('now-playing');
                        currentCard = this;
                        
                        // Show player island
                        musicPlayerIsland.style.display = 'block';
                        playerSongTitle.textContent = cardText;
                        currentTime.textContent = '0:00';
                        totalTime.textContent = '0:00';
                        progressBarFill.style.width = '0%';
                        
                        audioPlayer.src = '/music_sample/' + songFile;
                        audioPlayer.play();
                    }
                });
            });
        }
        
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', setupAudioPlayer);
        } else {
            setupAudioPlayer();
        }
    </script>
</body>
</html>